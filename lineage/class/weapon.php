<?php
// 資料庫連線設定
$mysqli = new mysqli("localhost", "root", "root", "class");
$mysqli->set_charset("utf8");

// 查詢所有裝備中武器
$sql = "SELECT c.char_name, i.item_id, i.enchantlvl
        FROM character_items i
        JOIN characters c ON i.char_id = c.objid
        WHERE i.is_equipped = 1";
$result = $mysqli->query($sql);

// 假設你有 item_id → 名稱的對照
$item_names = [
1 => "歐西斯匕首",
2 => "骰子匕首",
3 => "短劍的劍身",
4 => "匕首",
5 => "精靈匕首",
6 => "拉斯塔巴德短劍",
8 => "米索莉短劍",
9 => "奧裡哈魯根短劍",
10 => "小武士刀",
11 => "水晶短劍",
12 => "風刃短劍",
13 => "死亡之指(刻印)",
14 => "混沌之刺",
15 => "失去魔力的克特之劍",
16 => "復仇之劍",
17 => "受封印 被遺忘的巨劍",
18 => "受封印 被遺忘的劍",
19 => "長劍的劍身",
20 => "奧裡哈魯根的劍身",
21 => "歐西斯短劍",
22 => "鎖子甲破壞者",
23 => "闊劍",
24 => "短劍",
25 => "銀劍",
26 => "小侏儒短劍",
27 => "彎刀",
28 => "精靈短劍",
29 => "銀長劍",
30 => "紅騎士之劍(刻印)",
31 => "長劍",
32 => "侵略者之劍",
33 => "榮耀之劍",
34 => "血紅慾望短劍",
36 => "幻像之劍",
37 => "大馬士革刀",
38 => "拉斯塔巴德長劍",
39 => "短刀",
40 => "血色巨劍",
41 => "武士刀",
42 => "細劍",
43 => "海賊彎刀",
44 => "古代黑暗妖精之劍",
45 => "波曲王之劍",
46 => "生命之劍",
47 => "沉默之劍",
49 => "武官之刃",
50 => "赤焰之劍(刻印)",
51 => "黃金權杖(刻印)",
52 => "雙手劍",
53 => "蜥蜴王勇士之劍",
54 => "克特之劍",
55 => "黑暗之劍",
56 => "黑燄之劍(刻印)",
57 => "瑟魯基之劍",
58 => "死亡騎士的烈炎之劍",
59 => "騎士范德之劍",
60 => "末日刀",
61 => "真．冥皇執行劍",
62 => "武官雙手劍",
63 => "惡魔之劍",
64 => "巨劍",
65 => "天空之劍",
66 => "屠龍劍",
67 => "古老的巨劍",
68 => "古老的劍",
69 => "青銅雙刀",
70 => "尖刺雙刀",
71 => "鋼鐵雙刀",
72 => "暗影雙刀",
74 => "銀光雙刀",
75 => "黑暗雙刀",
76 => "倫得雙刀",
77 => "短雙刀",
78 => "暗殺軍王之痕",
79 => "深淵雙刀",
80 => "大馬士革雙刀",
81 => "幽暗雙刀",
82 => "拉斯塔巴德雙刀",
83 => "狄亞得雙刀",
84 => "暗黑雙刀",
85 => "惡魔雙刀",
86 => "紅影雙刀",
88 => "潘的角",
89 => "覆上米索莉的角",
90 => "巴迪須",
91 => "歐西斯之矛",
92 => "柴刀",
93 => "三叉戟",
94 => "帕提森",
95 => "矛",
96 => "矛",
97 => "吉薩",
98 => "闊矛",
99 => "精靈之矛",
100 => "覆上奧裡哈魯根的角",
101 => "拉斯塔巴德矛",
102 => "露西錘",
103 => "戟",
104 => "法丘",
106 => "貝卡合金",
107 => "深紅長矛",
108 => "失去魔力的惡魔鐮刀",
109 => "失去魔力的巴風特魔杖",
110 => "失去魔力的巴列斯魔杖",
111 => "失去魔力的冰之女王魔杖",
112 => "精靈短劍",
113 => "敏捷精靈短劍(刻印)",
114 => "威嚴權杖",
115 => "水晶魔杖(刻印)",
116 => "黑法師之杖",
118 => "漆黑水晶球",
119 => "惡魔鐮刀",
121 => "冰之女王魔杖",
122 => "拉斯塔巴德魔杖",
123 => "巴列斯魔杖",
124 => "巴風特魔杖",
125 => "巫術魔法杖",
126 => "瑪那魔杖(刻印)",
127 => "鋼鐵瑪那魔杖",
128 => "橡木魔法杖",
129 => "美基魔法杖",
130 => "紅水晶魔杖",
131 => "力量魔法杖",
132 => "神官魔杖",
133 => "古代人的智慧",
134 => "聖晶魔杖",
136 => "斧",
137 => "亞連",
138 => "木棒",
139 => "弗萊爾",
140 => "釘錘",
141 => "戰錘",
142 => "銀斧",
143 => "戰斧",
144 => "侏儒鐵斧",
145 => "狂戰士斧",
146 => "流星錘",
147 => "修練者斧頭",
148 => "巨斧",
149 => "牛人斧頭",
150 => "天父之怒",
152 => "青銅鋼爪",
153 => "鋼鐵鋼爪",
154 => "暗影鋼爪",
155 => "魔獸軍王之爪",
157 => "銀光鋼爪",
158 => "黑暗鋼爪",
159 => "短鋼爪",
160 => "獸王鋼爪",
161 => "大馬士革鋼爪",
162 => "幽暗鋼爪",
163 => "巴蘭卡鋼爪",
164 => "暗黑鋼爪",
165 => "惡魔鋼爪",
166 => "恨之鋼爪",
169 => "獵人之弓",
170 => "精靈弓",
171 => "歐西斯弓",
172 => "弓",
173 => "短弓",
174 => "象牙塔石弓",
175 => "象牙塔長弓",
176 => "拉斯塔巴德弓",
177 => "幽暗十字弓",
178 => "寂靜十字弓",
179 => "古代妖精弩槍",
180 => "十字弓",
181 => "尤米弓",
182 => "古老的弩槍",
183 => "幻象之弓",
184 => "赤焰之弓(刻印)",
185 => "惡魔十字弓",
186 => "狄亞得十字弓",
187 => "拉斯塔巴德十字弓",
188 => "拉斯塔巴德重十字弓",
189 => "暗黑十字弓",
190 => "沙哈之弓",
191 => "水之豎琴",
192 => "水精靈之弓",
195 => "受詛咒的真．冥皇執行劍",
206 => "黑暗精靈之劍",
207 => "煉獄鋼爪",
208 => "魔法精靈短劍(刻印)",
209 => "體質精靈短劍(刻印)",
210 => "守護者之矛",
211 => "獨角獸之角",
212 => "海神三叉戟",
213 => "吉爾塔斯魔杖",
215 => "敏捷精靈弓(刻印)",
217 => "吉爾塔斯之劍",
218 => "安加斯的釘錘",
259 => "魔力短劍",
260 => "狂風之斧",
261 => "大法師魔仗",
262 => "毀滅巨劍",
263 => "酷寒之矛",
264 => "雷雨之劍",
265 => "底比斯歐西里斯雙刀",
266 => "底比斯歐西里斯雙手劍",
268 => "底比斯歐西里斯魔杖",
271 => "黑曜石奇古獸",
273 => "破滅者鎖鏈劍",
274 => "反王肯恩的權杖",
500 => "象牙塔單手劍",
501 => "象牙塔雙手劍",
502 => "象牙塔魔杖",
503 => "象牙塔鋼爪",
504 => "象牙塔長弓",
505 => "象牙塔奇古獸",
506 => "象牙塔鎖鏈劍",
1001 => "亞連",
1002 => "木棒",
1003 => "釘錘",
1004 => "弗萊爾",
1005 => "流星錘",
1006 => "銀斧",
1007 => "戰斧",
1008 => "侏儒鐵斧",
1009 => "狂戰士斧",
1010 => "巨斧",
1011 => "三叉戟",
1012 => "帕提森",
1013 => "矛",
1014 => "精靈之矛",
1015 => "拉斯塔巴德矛",
1016 => "巴迪須",
1017 => "酷寒之矛",
1018 => "法丘",
1019 => "貝卡合金",
1020 => "深紅長矛",
1021 => "精靈匕首",
1022 => "拉斯塔巴德短劍",
1023 => "奧裡哈魯根短劍",
1024 => "小武士刀",
1025 => "水晶短劍",
1026 => "雙手劍",
1027 => "蜥蜴王勇士之劍",
1028 => "武官雙手劍",
1029 => "巨劍",
1030 => "屠龍劍",
1031 => "精靈弓",
1032 => "獵人之弓",
1033 => "敏捷精靈弓",
1034 => "拉斯塔巴德重十字弓",
1035 => "拉斯塔巴德十字弓",
1036 => "赤焰之弓",
1037 => "尤米弓",
1038 => "十字弓",
1039 => "幽暗十字弓",
1040 => "暗黑十字弓",
1041 => "消滅者鎖鏈劍",
1042 => "破滅者鎖鏈劍",
1043 => "撕碎者鎖鏈劍",
1044 => "抹殺者鎖鏈劍",
1045 => "神職者鎖鏈劍",
1046 => "冥封者鎖鏈劍",
1047 => "破日者鎖鏈劍",
1048 => "天行者鎖鏈劍",
1049 => "蒼天者鎖鏈劍",
1050 => "暗殺者鎖鏈劍",
1051 => "青銅鋼爪",
1052 => "鋼鐵鋼爪",
1053 => "魔獸軍王之爪",
1054 => "暗影鋼爪",
1055 => "銀光鋼爪",
1056 => "黑暗鋼爪",
1057 => "短鋼爪",
1058 => "幽暗鋼爪",
1059 => "大馬士革鋼爪",
1060 => "暗黑鋼爪",
1061 => "青銅雙刀",
1062 => "鋼鐵雙刀",
1063 => "銀光雙刀",
1064 => "暗影雙刀",
1065 => "黑暗雙刀",
1066 => "短雙刀",
1067 => "深淵雙刀",
1068 => "大馬士革雙刀",
1069 => "幽暗雙刀",
1070 => "暗黑雙刀",
1071 => "藍寶石奇古獸",
1072 => "黑曜石奇古獸",
1073 => "紅寶石奇古獸",
1074 => "綠寶石奇古獸",
1075 => "墨綠奇古獸",
1076 => "藍海奇古獸",
1077 => "白金奇古獸",
1078 => "水晶奇古獸",
1079 => "紫金奇古獸",
1080 => "鑲金奇古獸",
1081 => "水晶魔杖",
1082 => "漆黑水晶球",
1083 => "拉斯塔巴德魔杖",
1084 => "巫術魔法杖",
1085 => "瑪那魔杖",
1086 => "鋼鐵瑪那魔杖",
1087 => "橡木魔法杖",
1088 => "美基魔法杖",
1089 => "力量魔法杖",
1090 => "古代人的智慧",
1091 => "鎖子甲破壞者",
1092 => "銀長劍",
1093 => "紅騎士之劍",
1094 => "侵略者之劍",
1095 => "武士刀",
1096 => "大馬士革刀",
1097 => "細劍",
1098 => "武官之刃",
1099 => "赤焰之劍",
1100 => "黑焰之劍",
1101 => "小侏儒短劍",
1102 => "銀劍",
1103 => "魔法精靈短劍",
1104 => "體質精靈短劍",
1105 => "彎刀",
1106 => "敏捷精靈短劍",
1107 => "拉斯塔巴德長劍",
1108 => "海賊彎刀",
1109 => "古代黑暗妖精之劍",
1110 => "瑟魯基之劍",
1111 => "真鐵手甲",
1112 => "鐵手甲",
2001 => "亞連★",
2002 => "木棒★",
2003 => "釘錘★",
2004 => "弗萊爾★",
2005 => "流星錘★",
2006 => "銀斧★",
2007 => "戰斧★",
2008 => "侏儒鐵斧★",
2009 => "狂戰士斧★",
2010 => "巨斧★",
2011 => "三叉戟★",
2012 => "帕提森★",
2013 => "矛★",
2014 => "精靈之矛★",
2015 => "拉斯塔巴德矛★",
2016 => "巴迪須★",
2017 => "酷寒之矛★",
2018 => "法丘★",
2019 => "貝卡合金★",
2020 => "深紅長矛★",
2021 => "精靈匕首★",
2022 => "拉斯塔巴德短劍★",
2023 => "奧裡哈魯根短劍★",
2024 => "小武士刀★",
2025 => "水晶短劍★",
2026 => "雙手劍★",
2027 => "蜥蜴王勇士之劍★",
2028 => "武官雙手劍★",
2029 => "巨劍★",
2030 => "屠龍劍★",
2031 => "精靈弓★",
2032 => "獵人之弓★",
2033 => "敏捷精靈弓★",
2034 => "拉斯塔巴德重十字弓★",
2035 => "拉斯塔巴德十字弓★",
2036 => "赤焰之弓★",
2037 => "尤米弓★",
2038 => "十字弓★",
2039 => "幽暗十字弓★",
2040 => "暗黑十字弓★",
2041 => "消滅者鎖鏈劍★",
2042 => "破滅者鎖鏈劍★",
2043 => "撕碎者鎖鏈劍★",
2044 => "抹殺者鎖鏈劍★",
2045 => "神職者鎖鏈劍★",
2046 => "冥封者鎖鏈劍★",
2047 => "破日者鎖鏈劍★",
2048 => "天行者鎖鏈劍★",
2049 => "蒼天者鎖鏈劍★",
2050 => "暗殺者鎖鏈劍★",
2051 => "青銅鋼爪★",
2052 => "鋼鐵鋼爪★",
2053 => "魔獸軍王之爪★",
2054 => "暗影鋼爪★",
2055 => "銀光鋼爪★",
2056 => "黑暗鋼爪★",
2057 => "短鋼爪★",
2058 => "幽暗鋼爪★",
2059 => "大馬士革鋼爪★",
2060 => "暗黑鋼爪★",
2061 => "青銅雙刀★",
2062 => "鋼鐵雙刀★",
2063 => "銀光雙刀★",
2064 => "暗影雙刀★",
2065 => "黑暗雙刀★",
2066 => "短雙刀★",
2067 => "深淵雙刀★",
2068 => "大馬士革雙刀★",
2069 => "幽暗雙刀★",
2070 => "暗黑雙刀★",
2071 => "藍寶石奇古獸★",
2072 => "黑曜石奇古獸★",
2073 => "紅寶石奇古獸★",
2074 => "綠寶石奇古獸★",
2075 => "墨綠奇古獸★",
2076 => "藍海奇古獸★",
2077 => "白金奇古獸★",
2078 => "水晶奇古獸★",
2079 => "紫金奇古獸★",
2080 => "鑲金奇古獸★",
2081 => "水晶魔杖★",
2082 => "漆黑水晶球★",
2083 => "拉斯塔巴德魔杖★",
2084 => "巫術魔法杖★",
2085 => "瑪那魔杖★",
2086 => "鋼鐵瑪那魔杖★",
2087 => "橡木魔法杖★",
2088 => "美基魔法杖★",
2089 => "力量魔法杖★",
2090 => "古代人的智慧★",
2091 => "鎖子甲破壞者★",
2092 => "銀長劍★",
2093 => "紅騎士之劍★",
2094 => "侵略者之劍★",
2095 => "武士刀★",
2096 => "大馬士革刀★",
2097 => "細劍★",
2098 => "武官之刃★",
2099 => "赤焰之劍★",
2100 => "黑焰之劍★",
2101 => "小侏儒短劍★",
2102 => "銀劍★",
2103 => "魔法精靈短劍★",
2104 => "體質精靈短劍★",
2105 => "彎刀★",
2106 => "敏捷精靈短劍★",
2107 => "拉斯塔巴德長劍★",
2108 => "海賊彎刀★",
2109 => "古代黑暗妖精之劍★",
2110 => "瑟魯基之劍★",
2111 => "真鐵手甲★",
2112 => "鐵手甲★"
];

$data = [];

while ($row = $result->fetch_assoc()) {
    $item_id = $row['item_id'];
    if (!isset($item_names[$item_id])) continue;

    $data[] = [
        'char_name' => $row['char_name'],
        'weapon_name' => $item_names[$item_id],
        'enchant' => intval($row['enchantlvl'])
    ];
}

// 依強化值排序
usort($data, fn($a, $b) => $b['enchant'] - $a['enchant']);

// 取前10名
$data = array_slice($data, 0, 10);
?>
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <title>武器強化排行榜</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f0f0f0; padding: 20px; }
        h1 { color: #333; }
        table { width: 100%; border-collapse: collapse; background: white; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #444; color: #fff; }
        tr:nth-child(even) { background-color: #f9f9f9; }
        .rank { width: 60px; text-align: center; }
    </style>
</head>
<body>
    <h1>★ 武器強化值排行榜 ★</h1>
    <table>
        <thead>
            <tr>
                <th class="rank">排名</th>
                <th>玩家名稱</th>
                <th>武器名稱</th>
                <th>強化值</th>
            </tr>
        </thead>
        <tbody>
            <?php
            $rank = 1;
            foreach ($data as $row) {
                echo "<tr>
                        <td class='rank'>{$rank}</td>
                        <td>{$row['char_name']}</td>
                        <td>{$row['weapon_name']}</td>
                        <td>+{$row['enchant']}</td>
                      </tr>";
                $rank++;
            }
            ?>
        </tbody>
    </table>
</body>
</html>